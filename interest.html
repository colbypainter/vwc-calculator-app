<!doctype html>
<html>

	<head>
		<title>VWC Calculator App</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script type="text/javascript" src="benefit.js"></script>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<link rel="stylesheet" type="text/css" href="jquery-ui-1.10.4.custom.css">
		<script src="jquery-1.10.2.js"></script>
		<script type="text/javascript" src="jquery-ui-1.10.4.custom.js"></script>
		<script type = "text/javascript" src="jquery.maskedinput.js"></script>
		<link rel="stylesheet" type="text/css" href="style.css">


		<!-- PureCSS for menu only (non-responsive) -->
		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/menus-min.css">
		<!-- PureCSS for grids -->
		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css">
		<!-- PureCSS for table only -->
		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/tables-min.css">



		<script type="text/javascript">

		$(document).ready(function() {
			$("#interest-calc").on("submit", function() {
				var ben = new benefit();
				ben.DOI = $(this).find("#DOI").first().val();
				ben.startDate = $(this).find("#start-date").first().val();
				ben.endDate = $(this).find("#end-date").first().val();
				ben.weeksDue = ben.setWeeksDueWithDates();
				ben.compRate = $(this).find("#comp-rate").first().val();

				/* Write Weeks Due to the form */
				$(this).find("#weeks-due").first().val(ben.weeksDue);

				/* Interest rate is 6% annual broken down to daily. Is a constant rate. */
				var interestRate = 0.00016438;
				$(this).find("#interest-rate").first().val(interestRate);

				/* Calculate Due at Opinion and write it to the form */
				/* Depends on whether Opinion Date is after End Date */
				var endDate = new Date(ben.endDate);
				var opDate = $(this).find("#opinion-date").first().val();
				var dueAtOpinion = 0;
				opDate = new Date(opDate);
				if (opDate.getTime() > endDate.getTime()) {
					dueAtOpinion = Math.round(ben.weeksDue * ben.compRate * 100)/100;
				} else {
					var opinionWeeks = getWeeks(opDate, String(ben.startDate));
					dueAtOpinion = Math.round(opinionWeeks * ben.compRate * 100)/100;
				}
				$(this).find("#due-at-opinion").first().val(dueAtOpinion);

				/* Calculate Daily Rate and write to form */
				var dailyRate = Math.round(ben.compRate / 7 * 100)/100;
				$(this).find("#daily-rate").first().val(dailyRate);

				/* Calculate days delayed and write to form. Delay = Date of Opinion - Date Paid */
				var delay = new benefit();
				delay.startDate = $(this).find("#opinion-date").first().val();
				delay.endDate = $(this).find("#paid-date").first().val();
				var daysDelayed = Math.round(delay.setWeeksDueWithDates()*7) - 1;
				if (daysDelayed < 0) {
					daysDelayed = 0;
				}
				$(this).find("#days-delayed").first().val(daysDelayed);

				/* There are three scenarios to calculate Interest Due */
				var interest = 0;
				var paidDate = $(this).find("#paid-date").first().val();
				paidDate = new Date(paidDate);
				/* Scenario 1: Date of Opinion is after End Date */
				if (opDate.getTime() > endDate.getTime()) {
					interest = Math.round(dueAtOpinion * daysDelayed * interestRate * 100)/100;
				/* Scenario 2: Paid Date is after End Date */
				} else if (paidDate.getTime() > endDate.getTime()) {
					var localWeeks = getWeeks(opDate, endDate);
					interest = (dueAtOpinion * daysDelayed * interestRate) + (dailyRate * interestRate * (localWeeks * (localWeeks + 1)/2));
					localWeeks2 = getWeeks(endDate, paidDate);
					var additionalComp = (localWeeks/7) * ben.compRate;
					interest = interest + (localWeeks2 * additionalComp * interestRate);
				/* Scenario 3: All remaining scenarios */
				} else {
					interest = (dueAtOpinion * daysDelayed * interestRate) + (dailyRate * interestRate * (daysDelayed * (daysDelayed + 1)/2));
				}
				interest = Math.round(interest*100)/100;
				$(this).find("#interest-due").first().val(interest);

				/* Total Compensation */
				var totalComp = Math.round((ben.weeksDue * ben.compRate)*100)/100;
				$(this).find("#total-comp-due").first().val(totalComp);


				return false;

			});

				$("#interest-calc").on("change", "#DOI,#start-date,#end-date,#comp-rate,#opinion-date,#paid-date", function() {
					var compDue = $(this).closest("#interest-calc").find("#total-comp-due").first().val();
					if (compDue != "") {
						$(this).closest("#interest-calc").find("#weeks-due").first().val("");
						$(this).closest("#interest-calc").find("#interest-rate").first().val("");
						$(this).closest("#interest-calc").find("#due-at-opinion").first().val("");
						$(this).closest("#interest-calc").find("#daily-rate").first().val("");
						$(this).closest("#interest-calc").find("#days-delayed").first().val("");
						$(this).closest("#interest-calc").find("#interest-due").first().val("");
						$(this).closest("#interest-calc").find("#total-comp-due").first().val("");
					}
				});


				$(".datepicker").datepicker( {
						showOn: "button",
						buttonImage: "http://jqueryui.com/resources/demos/datepicker/images/calendar.gif",
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true
				});

				/* Input mask for date inputs */
	            jQuery(function($) {
	               $(".date").mask("99/99/9999");
	            });

		});
		</script>

	</head>

	<body>

		<!-- The navigation menu -->
		<div id="Nav" class="pure-menu pure-menu-open pure-menu-horizontal">

			<ul>
				<li><a href="index.html">Main</a></li>
				<li><a href="BasicCalc.html">Basic Calculator</a></li>
				<li><a href="MultiplePeriods.html">Multiple Periods</a></li>
				<li><a href="LumpSum.html">Calculate Lump Sum</a></li>
				<li class="pure-menu-selected" ><a href="interest.html">Interest Calculator</a></li>
				<li><a href="COLACalc.html">COLA Calculator</a></li>
			</ul>
		</div>

			<!-- New Divs for calc explainers. Optional improvements. -->
			<div id="ref_content" class="pure-g">
				<div id="exp_box" class="pure-u-1-3">
					<h3>About This Calculator</h3>
					<p>If payment of benefits is delayed due to appeal, the injured worker
					may be eligible for interest.  Use this calculator to determine the amount of
					interest that may be due.</p>
				</div>
				<div id="rate_box" class="pure-u-1-3">
					<h3>Rate Information</h3>
					<p>Click the table below to display yearly maximum and minimum
						compensation rates, as well as the Cost of Living percentage for each year.
						Please note that rate years begin on <span class="rate_emph">July 1st</span>
						and conclude on <span class="rate_emph">June 30th</span> each year.</p>

				</div>
					<div id="dw_box" class="pure-u-1-3">
						<h3>Day-Week Conversions</h3>
							<table id="day-week-ref" class="pure-table pure-table-bordered">
							<thead>
								<th>Days</th>
								<th>Weeks</th>
							</thead>
							<tr>
								<td>1 Day</td>
								<td>.14286 Weeks</td>
							</tr>
							<tr>
								<td>2 Days</td>
								<td>.28571 Weeks</td>
							</tr>
							<tr>
								<td>3 Days</td>
								<td>.42857 Weeks</td>
							</tr>
							<tr>
								<td>4 Days</td>
								<td>.57143 Weeks</td>
							</tr>
							<tr>
								<td>5 Days</td>
								<td>.71429 Weeks</td>
							</tr>
							<tr>
								<td>6 Days</td>
								<td>.85714 Weeks</td>
							</tr>
						</table>
					</div>
				</div>
			</div>  <!-- End of NEW reference div -->

			<div id="Container">
			<div id="Calculator" style="height: 535px">
				<h1>Calculate Interest</h1>
					<form id="interest-calc">
						<fieldset name="requiredFields">
							<legend>Enter Required Benefit Info</legend>
								<div align="left">

									<label for="DOI">Accident Date</label>
									<input type="text" name="DOI" class="datepicker date" value="" id="DOI" maxlength="10" size="10" ><br>

									<label for="opinion-date">Date of Opinion</label>
									<input type="text" name="opinion-date" class="datepicker date" value="" id="opinion-date" maxlength="10" size="10" ><br>

									<label for="start-date">Benefit Start Date</label>
									<input type="text" name="start-date" class="datepicker date" value="" id="start-date" maxlength="10" size="10" ><br>

									<label for="endDate">Benefit End Date</label>
									<input type="text" name="end-date" class="datepicker date" value="" id="end-date" maxlength="10" size="10" ><br>

									<label for="compRate">Compensation Rate</label>
									<input type="text" name="comp-rate" value="" id="comp-rate" maxlength="7" size="7" ><br>

									<label for="paid-date">Date Paid</label>
									<input type="text" name="paid-date" class="datepicker date" value="" id="paid-date" maxlength="10" size="10" ><br>
							<input type="submit" name="calculate" value="Calculate">
								</div>
						</fieldset>

						<fieldset name="interestData">
							<legend>Interest Details</legend>
								<div align="right">
									<label for="weeks-due">Weeks Due</label>
										<input type="text" name="weeks-due" value="" id="weeks-due" maxlength = "7" size="15" readonly><br>

									<label for="interest-rate">Daily Interest Rate</label>
										<input type="text" name="interest-rate" value="" id="interest-rate" size="15" maxlength="10" readonly><br>

									<label for="due-at-opinion">Due At Opinion</label>
										<input type="text" name="due-at-opinion" value="" id="due-at-opinion" size="15" maxlength="15" readonly><br>

									<label for="daily-rate">Daily Rate</label>
										<input type="text" name="daily-rate" value=""  id="daily-rate" size="15" maxlength="7" readonly><br>

									<label for="days-delayed">Days Delayed</label>
										<input type="text" name="days-delayed" value="" id="days-delayed" size="15" readonly><br>

									<label for="interest-due">Interest Due</label>
										<input type="text" name="interest-due" value=""  id="interest-due" size="15" readonly><br>

									<label for="total-comp-due">Total Compensation</label>
										<input type="text" name="total-comp-due" value="" id="total-comp-due" size="15" readonly><br>
									<input type="reset" name="reset" value="Reset Form">
								</div>
						</fieldset>
				</form>
			</div>
		</div>

		<!-- New footer for redesign -->
		<div id="footer">
			<p>&copy 2014 Virginia Workers' Compensation Commission</p>
			<p><a href="http://www.vwc.state.va.us">VWC Public Website</a></p>
		</div>

	</body>
</html>

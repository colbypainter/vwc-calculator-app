<!doctype html>
<html>

	<head>
		<title>VWC Calculator App</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script type="text/javascript" src="benefit.js"></script>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<link rel="stylesheet" type="text/css" href="jquery-ui-1.10.4.custom.css">
		<script src="jquery-1.10.2.js"></script>
		<script type="text/javascript" src="jquery-ui-1.10.4.custom.js"></script>
		<link rel="stylesheet" type="text/css" href="style.css">
        <script type = "text/javascript" src="jquery.maskedinput.js"></script>
		<script type="text/javascript">

			$(document).ready(function() {

            /* Input mask for date inputs */
            jQuery(function($) {
               $(".date").mask("99/99/9999");
            });

			$("#cola_calculator").on('submit', function() {

                var ben = new benefit();
                ben.DOI = $(this).find("#_DOI").first().val();
                ben.startDate = $(this).find("#start_date").first().val();
                ben.endDate = $(this).find("#end_date").first().val();
                ben.compRate = $(this).find("#comp_rate").first().val();
                ben.getCola();
             
                // Find jQuery elements here
                var $benRowContainer = $("#row-wrap");
                var $benRowTemplate = $("#benefit-row-template");
                var $benRow;
                var rowHighlight = false;
                var currentYear;

               
                // Clear any previous result rows:
                $benRowContainer.empty();
                     
                for(var i=1; i < ben.colaPeriods.length; i++){
                    
                    // Copy the template element
                    $benRow = $benRowTemplate.clone();
                    colaPeriod = ben.colaPeriods[i];

                    // Set values inside $benRow
                    $benRow.find(".cola_rate").html( colaPeriod['cola-rate'] );
                    $benRow.find(".from_date").html( colaPeriod['begin'] );
                    $benRow.find(".cola_column").html( colaPeriod['cola'] );
                    $benRow.find(".cola_due").html( colaPeriod['cola-due'] );
                    $benRow.find(".cc_rate").html( colaPeriod['comp-rate'] );
                    $benRow.find(".to_date").html( colaPeriod['end'] );
                    $benRow.find(".max_rate").html( colaPeriod['max'] );
                    $benRow.find(".prev_rate").html( colaPeriod['previous-rate'] );
                    $benRow.find(".weeks_column").html( colaPeriod['weeks-due'] );
                    $benRow.find(".rate_year").html( colaPeriod['year'] );

                    // Set Total values
                    var colaPaid = $(this).find("#cola_paid").first().val(); 
                    $("#total-row").find("#compounded-comp-rate").val(ben.compoundedCompRate);
                    $("#total-row").find("#max-in-effect").val(ben.maxInEffect);
                    $("#total-row").find("#total-due").val(ben.colaDue);
                    $("#total-row").find("#total-diff").val(ben.colaDue - Number(colaPaid));
                    
                    // Check for row highlighting:
                    if(currentYear != colaPeriod['year']){
                        currentYear = colaPeriod['year'];
                        rowHighlight = rowHighlight ? false : true;
                    }
                    
                    if(rowHighlight){
                        $benRow.addClass('stripe-row');
                    } else {
                        $benRow.removeClass('stripe-row');
                    }

                    // Check for max alerts
                    if( colaPeriod['previous-rate'] > colaPeriod['max'] ){
                        $benRow.find(".prev_rate").parent().addClass("alert");
                        $benRow.find(".max_rate").parent().addClass("alert");
                    }
                    if( colaPeriod['comp-rate'] > colaPeriod['max'] ){
                        $benRow.find(".cc_rate").parent().addClass("alert");
                        $benRow.find(".max_rate").parent().addClass("alert");
                    }

                    // Add new row to DOM and display it
                    $benRowContainer.append( $benRow.show() );
                }
                return false;
			});
            
            $("#comp_rate").on("change", function() {
                    var ben = new benefit();
                    ben.DOI = $("#cola-inputs").find("#_DOI").first().val();
                    ben.compRate = $("#cola-inputs").find("#comp_rate").first().val();
                    ben.setRateYear(ben.DOI);
                    if (Number(ben.compRate) >= Number(ben.rates[ben.rateYear]["MAX"])) {
                        $("#cola-inputs").find("#comp_rate").first().val(ben.rates[ben.rateYear]["MAX"]);
                        $("#cola-inputs").find("#comp_rate").first().css("background-color", "#F5AEBE");
                    } else {
                        $("#cola-inputs").find("#comp_rate").first().css("background-color", "#DEEDFC");
                    }
                    return false;
                });
            
		});
		</script>
</head>
<body>
        <div id="Nav">
            <ul>
                <li><a href="http://www.vwc.state.va.us/portal/vwc-website">VWC Public Website</a><br><br></li>
                <li><a href="index.html">Main</a></li>
                <li><a href="BasicCalc.html">Basic Calculator</a></li>
                <li><a href="MultiplePeriods.html">Multiple Periods</a></li>
                <li><a href="LumpSum.html">Calculate Lump Sum</a></li>
                <li><a href="interest.html">Interest Calculator</a></li>
                <li>COLA Calculator</li>
            </ul>
        </div>

        <div id="Container">
            <div id="Calculator" style="width: 900px;">
                <h1>Calculate COLA Amounts</h1>
                <form id="cola_calculator">
                    <div id="cola-inputs">
                        <span><strong>Enter Benefit Information</strong></span><br>
                            <input type="text" value="" id="_DOI" class = "date" size="12">
                            <label for="_DOI">Accident Date</label>
                        <br>
                            <input type="text" value="" id="start_date" class = "date" size="12">
                            <label for="start_date">Begin Date</label>
                        <br>
                            <input type="text" value="" id="end_date" class = "date" size="12">
                            <label for="end_date">End Date</label>
                        <br>
                            <input type="text" value="" id="comp_rate" size="12">
                            <label for="comp_rate">Compensation Rate</label>
                        <br>
                            <input type="text" value="" id="cola_paid" size="12">
                            <label for="cola_paid">COLA Paid</label>
                        <br>
                            <input type="submit" value="Calculate" id="calculate">
                            <input type="reset" value="Reset" id="reset">
                    </div>
                </form>

                <div id="total-row">
                    <span><strong>Results</strong></span><br>
                    <label>Compounded Comp Rate
                    <input type="text" value="" id="compounded-comp-rate" readonly>
                    </label><br>

                    <label>Maximum In Effect
                    <input type="text" value="" id="max-in-effect" readonly>
                    </label><br>

                    <label>Total Due
                    <input type="text" value="" id="total-due" readonly>
                    </label><br>

                    <label>Difference
                    <input type="text" value="" id="total-diff" readonly>
                    </label><br>

                </div>

                <br><br>
               
                <table id="cola-table">
                    <thead>
                        <tr><th>Rate Year</th>
                            <th>COLA %</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Previous Rate</th>
                            <th>CC Rate</th>
                            <th>Max Rate</th>
                            <th>COLA</th>
                            <th>Weeks</th>
                            <th>COLA Due</th></tr>
                    </thead>

                    <tbody id="row-wrap">
                        <tr id="benefit-row-template" class="benefit_row">
                            <td><span class="rate_year"></span></td>
                            <td><span class="cola_rate"></span></td>
                            <td><span class="from_date"></span></td>
                            <td><span class="to_date"></span></td>
                            <td><span class="prev_rate"></span></td>
                            <td><span class="cc_rate"></span></td>
                            <td><span class="max_rate"></span></td>
                            <td><span class="cola_column"></span></td>
                            <td><span class="weeks_column"></span></td>
                            <td><span class="cola_due"></span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

</body>
</html>
